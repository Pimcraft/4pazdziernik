<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dom√≥wka: Kuchnie ≈öwiata!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-color: #16213e;
            --primary-color: #e94560;
            --text-color: #e0e0e0;
            --text-muted: #a7a7a7;
            --border-color: #0f3460;
            --border-radius: 16px;
            --font-main: 'Poppins', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-main); background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 2rem 1rem; }
        .container { background-color: var(--card-color); border: 1px solid var(--border-color); padding: 2rem 2.5rem; border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); width: 100%; max-width: 900px; text-align: center; transition: all 0.3s ease; margin-bottom: 2rem; }
        h1, h2, h3 { font-weight: 700; margin-bottom: 1rem; }
        h1 { color: var(--primary-color); font-size: 2.5rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.2rem; color: var(--text-muted); }
        p { color: var(--text-muted); line-height: 1.6; margin-bottom: 1.5rem; }
        .lore-section { text-align: left; margin: 2rem 0; padding: 1.5rem; background-color: rgba(15, 52, 96, 0.3); border-radius: var(--border-radius); border-left: 4px solid var(--primary-color); }
        .lore-section p { margin-bottom: 0.5rem; }
        .button-group { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; }
        button, .button { background: var(--primary-color); color: white; border: none; padding: 0.8rem 1.8rem; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        button:hover, .button:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4); }
        button:disabled { background-color: #555; cursor: not-allowed; transform: none; box-shadow: none; }
        button.secondary { background: var(--border-color); }
        .form-group { margin: 1.5rem 0; text-align: left; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; color: var(--text-muted); }
        select, .radio-group { width: 100%; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 0.8rem 1rem; border-radius: 8px; font-size: 1rem; font-family: var(--font-main); }
        .radio-group { display: flex; justify-content: space-around; }
        
        /* --- NOWE STYLE ANIMACJI --- */
        #carousel-container {
            height: 120px;
            width: 100%;
            margin: 2rem auto;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
        }
        #carousel-track {
            display: flex;
            position: relative;
            left: 50%;
        }
        .carousel-item {
            flex-shrink: 0;
            width: 100px;
            height: 100px;
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--border-color);
            border-radius: 10px;
            transition: transform 0.3s ease;
        }
        .carousel-item .icon { font-size: 2.5rem; }
        .carousel-item .name { font-size: 0.8rem; font-weight: 600; margin-top: 5px; }

        #carousel-pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background-color: var(--primary-color);
            z-index: 10;
            box-shadow: 0 0 10px var(--primary-color);
        }

        /* Klasa dodawana do uruchomienia animacji */
        .spinning {
            transition: left 5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        #results-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        #results-table th, #results-table td { padding: 0.8rem 1rem; text-align: left; }
        #results-table thead { background-color: var(--border-color); }
        #results-table tbody tr { border-bottom: 1px solid var(--border-color); }
        #results-table tbody tr:nth-child(even) { background-color: rgba(15, 52, 96, 0.3); }
        .hidden { display: none !important; }
        
         /* --- NOWE STYLE SEKCJI SZCZEG√ì≈Å√ìW --- */
        .details-section {
            text-align: left;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
        .details-section h2 {
            text-align: center;
            color: var(--primary-color);
        }
        .details-box {
            background-color: rgba(15, 52, 96, 0.3);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 2rem;
        }
        .details-box h3 {
            color: var(--text-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .transport-table {
            width: 100%;
            font-size: 0.9rem;
        }
        .transport-table td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .transport-table td:first-child {
            width: 140px;
            white-space: nowrap;
        }
        .map-gallery {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }
        .map-gallery img {
            width: 31%;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .map-gallery img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }
        
        /* --- STYLE MODALA (POWIƒòKSZONEGO ZDJƒòCIA) --- */
        #lightbox {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #lightbox.active {
            opacity: 1;
            visibility: visible;
        }
        #lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--border-radius);
        }
        #lightbox .close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 3rem;
            color: white;
            cursor: pointer;
        }
         .transport-icon {
            display: inline-block;
            width: 30px;
            text-align: center;
        }
        
    </style>
</head>
<body>
<div id="lightbox" class="hidden">
        <span class="close">&times;</span>
        <img id="lightbox-img" src="">
    </div>

    <div class="container">
        <div id="content-wrapper">
             <div id="step-invite">
                <h1>Dom√≥wka: Kuchnie ≈öwiata! üó∫Ô∏è</h1>
                <h3>Zaproszenie na epickƒÖ podr√≥≈º kulinarnƒÖ</h3>
                <p>Zanim przejdziemy dalej, odpowiedz na jedno, arcywa≈ºne pytanie...</p>
                <h2>Czy <u>4 pa≈∫dziernika</u> masz ochotƒô uczestniczyƒá w tej imprezie?</h2>
                <div class="lore-section">
                    <p>üå∂Ô∏è <strong>Idea jest prosta:</strong> Ka≈ºdy uczestnik (lub para) losuje kuchniƒô i przygotowuje jedno, charakterystyczne dla niej danie.</p>
                    <p>üé≤ <strong>Na miejscu czekajƒÖ:</strong> Zacne trunki, gry bez prƒÖdu, integracja i ploteczki do oporu.</p>
                    <p>ü§ù <strong>Cel:</strong> Spr√≥bowaƒá pysznego jedzenia i ≈õwietnie siƒô bawiƒá w doborowym towarzystwie!</p>
                </div>
                <div class="button-group">
                    <button id="btn-attend-yes">üéâ Tak, bƒôdƒô!</button>
                    <button id="btn-attend-no" class="secondary">üò¢ Niestety, nie tym razem</button>
                </div>
            </div>

            <div id="step-details" class="hidden">
                <h2>Super, ≈ºe bƒôdziesz!</h2>
                <p>Uzupe≈Çnij jeszcze dwie rzeczy, aby≈õmy mogli wszystko przygotowaƒá.</p>
                <div class="form-group">
                    <label>Jestem...</label>
                    <select id="person-select"></select>
                </div>
                <div class="form-group">
                    <label>Czy bƒôdziesz z osobƒÖ towarzyszƒÖcƒÖ?</label>
                    <div class="radio-group" id="guest-choice">
                        <label><input type="radio" name="guest" value="yes" checked> Tak</label>
                        <label><input type="radio" name="guest" value="no"> Nie</label>
                    </div>
                </div>
                <button id="btn-to-drawing">Przejd≈∫ do losowania</button>
            </div>

            <div id="step-drawing" class="hidden">
                <h2>Czas na losowanie!</h2>
                <p>Kliknij przycisk i poznaj swoje kulinarne przeznaczenie.</p>
                <div id="carousel-container">
                    <div id="carousel-pointer"></div>
                    <div id="carousel-track"></div>
                </div>
                <button id="spin-button">Rozpocznij losowanie!</button>
            </div>
        </div>
        
        <div id="results-section">
            <h2 id="result-announcement"></h2>
            <h3>Aktualna lista go≈õci i kuchni</h3>
            <table id="results-table">
                <thead>
                    <tr>
                        <th>Imiƒô</th>
                        <th>Obecno≈õƒá</th>
                        <th>+1</th>
                        <th>Wylosowana Kuchnia</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    <tr><td colspan="4">≈Åadowanie danych...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="container details-section">
        <h2>Szczeg√≥≈Çy Imprezy</h2>
        
        <div class="details-box">
            <h3>üóìÔ∏è Czas, Miejsce i Zasady</h3>
            <p><strong>Kiedy:</strong> Sobota, 4 pa≈∫dziernika 2025, start o <strong>18:00</strong>.<br>
               <strong>Gdzie:</strong> ul. Awicenny 32a/12, Wroc≈Çaw.</p>
            <p style="margin-bottom: 0;">Ka≈ºda osoba/para przygotowuje <strong>tylko jedno danie</strong> z wylosowanej kuchni. Prosimy nie przynosiƒá za du≈ºo jedzenia, aby nic siƒô nie zmarnowa≈Ço!</p>
        </div>

        <div class="details-box">
            <h3>ü•Ç Alkohole i Nastr√≥j</h3>
            <p>üç∑ Zapewniamy podstawowe ilo≈õci <strong>wina bia≈Çego wytrawnego</strong>.<br>
               ü•É Dostƒôpna bƒôdzie r√≥wnie≈º butelka <strong>whisky</strong>.<br>
               üßä Dla fan√≥w mocniejszych trunk√≥w czekaƒá bƒôdzie zmro≈ºona <strong>w√≥dka</strong>.<br>
               ü•§ Oczywi≈õcie postawiƒô te≈º kilka <strong>napoj√≥w bezalkoholowych</strong> i przekƒÖsek.<br>
               üëï ObowiƒÖzuje str√≥j <strong>lu≈∫ny i wygodny</strong>.<br>
               üòä Nastr√≥j: <strong>poprawny</strong> (przynajmniej na starcie)!
            </p>
        </div>

         <div class="details-box">
            <h3>‚ùó Wa≈ºne Info / Alergeny</h3>
            <p style="margin-bottom: 0;">üêà‚Äç‚¨õ Ostrze≈ºenie dla alergik√≥w i pedant√≥w! W domu rezydujƒÖ dwa koty (<strong>czarny ‚ö´</strong> i <strong>bia≈Ço-bury ‚ö™</strong>). Ich sier≈õƒá jest integralnƒÖ czƒô≈õciƒÖ wystroju mieszkania i na pewno wyjdziecie niƒÖ oblepieni. Zapewniamy rolkƒô do ubra≈Ñ! ‚ú®</p>
        </div>

        <div class="details-box">
            <h3>üöó Transport i Dojazd</h3>
            <table class="transport-table">
                <tbody>
                    <tr><td><span class="transport-icon">‚úàÔ∏è</span> Lotnisko</td><td>ok. 20 min samochodem</td></tr>
                    <tr><td><span class="transport-icon">üöÜ</span> Dworzec Zach.</td><td>ok. 5 min pieszo üö∂</td></tr>
                    <tr><td><span class="transport-icon">üÖøÔ∏è</span> Parking Biedronka</td><td>2 min pieszo üö∂</td></tr>
                    <tr><td><span class="transport-icon">üöå</span> <strong>Chachaja</strong></td><td>Linia: 132 (pod samym domem)</td></tr>
                    <tr><td><span class="transport-icon">üöå</span> <strong>Jordanowska</strong></td><td>Linie: 132, 125, 907, 947 (4 min pieszo üö∂)</td></tr>
                    <tr><td><span class="transport-icon">üöå</span> <strong>Wiejska</strong></td><td>Linie: 107, 119, 125, 132, 143, 251, 257, 319, 607, 907, 947 (7 min pieszo üö∂)</td></tr>
                    <tr><td><span class="transport-icon">üöä</span> <strong>Pƒôtla Opor√≥w</strong></td><td>Tramwaje: 4, 11, 20. Autobusy: 107, 119, 125, 143, 251, 319 (8 min pieszo üö∂)</td></tr>
                    <tr><td><span class="transport-icon">üö¢</span> Statek</td><td>Ruch morski niedostƒôpny</td></tr>
                    <tr><td><span class="transport-icon">üõ∏</span> Dron</td><td>Ruch dronowy dostƒôpny tylko ze wschodu</td></tr>
                </tbody>
            </table>
        </div>

         <div class="details-box">
            <h3>üó∫Ô∏è Mapy Dojazdu (kliknij, aby powiƒôkszyƒá)</h3>
            <div class="map-gallery">
                <img src="1.png" alt="Mapa okolicy">
                <img src="2.png" alt="Mapa transportu">
                <img src="3.png" alt="Mapa parkingu">
            </div>
        </div>
    </div>
    

<script>
// 1. KONFIGURACJA
const JSONBIN_API_KEY = '$2a$10$uss5q/ZpmJgrr7GzC4iEbeG3Px6iazRf/KFqHsIUnm/85HaEFl5Fm';
const JSONBIN_BIN_ID = '68ca4e62d0ea881f4080a276';
const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
const MAX_RETRIES = 5;

// 2. REFERENCJE DO ELEMENT√ìW DOM
const steps = {
    invite: document.getElementById('step-invite'),
    details: document.getElementById('step-details'),
    drawing: document.getElementById('step-drawing'),
};
const contentWrapper = document.getElementById('content-wrapper');
const resultsSection = document.getElementById('results-section');
const personSelect = document.getElementById('person-select');
const historyBody = document.getElementById('history-body');
const spinButton = document.getElementById('spin-button');
const resultAnnouncement = document.getElementById('result-announcement');
const carouselTrack = document.getElementById('carousel-track');

// 3. STAN APLIKACJI
let appData = {
    participants: [],
    availableCuisines: []
};
let currentUser = { name: null };
let isSpinning = false;

// 4. FUNKCJE NAWIGACYJNE I WIDOKU
const goToStep = (stepName) => {
    Object.values(steps).forEach(step => step.classList.add('hidden'));
    if (steps[stepName]) {
        steps[stepName].classList.remove('hidden');
    }
};

const renderHistoryTable = () => {
    historyBody.innerHTML = '';
    if (!appData.participants || appData.participants.length === 0) {
        historyBody.innerHTML = '<tr><td colspan="4">Brak danych o uczestnikach.</td></tr>';
        return;
    }
    appData.participants.forEach(p => {
        const row = document.createElement('tr');
        const attendingText = p.attending === null ? '‚ùî' : (p.attending ? '‚úÖ Tak' : '‚ùå Nie');
        const guestText = p.attending ? (p.guest ? 'üë§ Tak' : '‚ûñ Nie') : '‚ûñ';
        const cuisineText = p.attending ? (p.cuisine || '<em>Czeka na losowanie</em>') : '‚ûñ';
        row.innerHTML = `<td>${p.base}</td><td>${attendingText}</td><td>${guestText}</td><td>${cuisineText}</td>`;
        historyBody.appendChild(row);
    });
};

const initializeCarousel = (cuisines) => {
    carouselTrack.innerHTML = '';
    const extendedCuisines = [...cuisines, ...cuisines, ...cuisines, ...cuisines, ...cuisines];
    
    extendedCuisines.forEach(cuisine => {
        const item = document.createElement('div');
        item.className = 'carousel-item';
        item.innerHTML = `<span class="icon">${cuisine.icon}</span><span class="name">${cuisine.name}</span>`;
        carouselTrack.appendChild(item);
    });
};

// 5. LOGIKA DANYCH I API
const delay = ms => new Promise(res => setTimeout(res, ms));

const fetchWithRetry = async (url, options, retries = MAX_RETRIES) => {
    for (let i = 0; i <= retries; i++) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                 throw new Error(`B≈ÇƒÖd HTTP: ${response.status}`);
            }
            return response;
        } catch (error) {
            console.error(`Pr√≥ba ${i + 1} nieudana:`, error.message);
            if (i === retries) {
                console.error("OsiƒÖgniƒôto maksymalnƒÖ liczbƒô pr√≥b. Poddajƒô siƒô.");
                throw error;
            }
            await delay(1000 * (i + 1)); // Czekaj 1, 2, 3... sekundy
        }
    }
};

const loadData = async () => {
    try {
        const response = await fetchWithRetry(`${JSONBIN_URL}/latest`, { headers: { 'X-Master-Key': JSONBIN_API_KEY } });
        const data = await response.json();
        appData = data.record;
        renderHistoryTable();
        populatePersonSelect();
    } catch (error) {
        console.error("B≈ÇƒÖd ≈Çadowania danych po wielu pr√≥bach:", error);
        historyBody.innerHTML = '<tr><td colspan="4">Nie uda≈Ço siƒô za≈Çadowaƒá danych. Od≈õwie≈º stronƒô i spr√≥buj ponownie.</td></tr>';
    }
};

const saveData = async () => {
    try {
        await fetchWithRetry(JSONBIN_URL, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_API_KEY },
            body: JSON.stringify(appData)
        });
        await loadData();
    } catch (error) {
        console.error("B≈ÇƒÖd zapisu danych po wielu pr√≥bach:", error);
        resultAnnouncement.innerHTML = `<h2 style="color:red">B≈ÇƒÖd zapisu! Spr√≥buj ponownie.</h2>`;
    }
};


const populatePersonSelect = () => {
    personSelect.innerHTML = '';
    let availablePeople = 0;
    if (appData.participants) {
        appData.participants.forEach(p => {
            if (p.attending === null || (p.attending && !p.cuisine)) {
                const option = document.createElement('option');
                option.value = p.base;
                option.textContent = p.declined;
                personSelect.appendChild(option);
                availablePeople++;
            }
        });
    }
    if (availablePeople === 0) {
        document.getElementById('step-details').innerHTML = '<p>WyglƒÖda na to, ≈ºe wszyscy ju≈º wziƒôli udzia≈Ç. Zobacz wyniki poni≈ºej!</p>';
    }
};

const startCarousel = () => {
    if (isSpinning) return;
    const availableCuisines = appData.availableCuisines;
    if (!availableCuisines || availableCuisines.length === 0) {
        alert("Wszystkie kuchnie zosta≈Çy ju≈º wylosowane!");
        return;
    }

    isSpinning = true;
    spinButton.disabled = true;

    const randomIndex = Math.floor(Math.random() * availableCuisines.length);
    const selectedCuisine = availableCuisines[randomIndex];

    const targetIndex = availableCuisines.length + randomIndex;
    const itemWidth = 120;
    const targetPosition = - (targetIndex * itemWidth) + (carouselTrack.parentElement.clientWidth / 2) - (itemWidth / 2);

    carouselTrack.classList.add('spinning');
    carouselTrack.style.left = `${targetPosition}px`;

    setTimeout(async () => {
        const cuisineString = selectedCuisine.name + " " + selectedCuisine.icon;
        resultAnnouncement.innerHTML = `<h2>Gratulacje, <span style="color:var(--primary-color)">${currentUser.name}!</span></h2>
                                      <p>Twoje przeznaczenie to: <strong>${cuisineString}</strong></p>`;
        
        const personIndex = appData.participants.findIndex(p => p.base === currentUser.name);
        if (personIndex > -1) {
            appData.participants[personIndex].cuisine = cuisineString;
            appData.availableCuisines.splice(randomIndex, 1);
        }
        
        await saveData();
        isSpinning = false;
        contentWrapper.classList.add('hidden');
    }, 5100);
};


// 7. INICJALIZACJA I OBS≈ÅUGA ZDARZE≈É
document.addEventListener('DOMContentLoaded', () => {
    
    document.getElementById('btn-attend-yes').addEventListener('click', () => {
        goToStep('details');
    });

    document.getElementById('btn-attend-no').addEventListener('click', async () => {
        const name = prompt("Aby zapisaƒá TwojƒÖ decyzjƒô, podaj proszƒô swoje imiƒô (np. Iwona):");
        if (name) {
            const personIndex = appData.participants.findIndex(p => p.base.toLowerCase() === name.toLowerCase());
            if (personIndex > -1) {
                appData.participants[personIndex].attending = false;
                await saveData();
                contentWrapper.classList.add('hidden');
                resultAnnouncement.innerHTML = `<h2>Dziƒôki za informacjƒô!</h2><p>Do zobaczenia nastƒôpnym razem.</p>`;
            } else {
                alert("Nie znaleziono takiego imienia na li≈õcie.");
            }
        }
    });
    
    document.getElementById('btn-to-drawing').addEventListener('click', () => {
        currentUser.name = personSelect.value;
        const personData = appData.participants.find(p => p.base === currentUser.name);

        if (personData && personData.cuisine) {
            alert('Ju≈º bra≈Çe≈õ/a≈õ udzia≈Ç w losowaniu! Zobacz sw√≥j wynik w tabeli.');
            contentWrapper.classList.add('hidden');
            resultAnnouncement.innerHTML = `<h2>Tw√≥j wynik jest ju≈º w tabeli, ${personData.base}!</h2>`;
            return;
        }

        const personIndex = appData.participants.findIndex(p => p.base === currentUser.name);
        if (personIndex > -1) {
            appData.participants[personIndex].attending = true;
            appData.participants[personIndex].guest = document.querySelector('input[name="guest"]:checked').value === 'yes';
        }
        
        initializeCarousel(appData.availableCuisines);
        goToStep('drawing');
    });

    spinButton.addEventListener('click', startCarousel);
    
    loadData();
    goToStep('invite');
});
// --- DODATKOWA LOGIKA DLA GALERII MAP ---
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const galleryImages = document.querySelectorAll('.map-gallery img');

    galleryImages.forEach(img => {
        img.addEventListener('click', () => {
            lightbox.classList.remove('hidden');
            lightbox.classList.add('active');
            lightboxImg.src = img.src;
        });
    });

    lightbox.addEventListener('click', (e) => {
        if (e.target !== e.currentTarget && e.target.tagName !== 'SPAN') return;
        lightbox.classList.remove('active');
        setTimeout(() => {
            lightbox.classList.add('hidden');
        }, 300);
    });
</script>

</body>
</html>

