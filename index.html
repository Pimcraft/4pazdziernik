<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DomÃ³wka: Kuchnie Åšwiata!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-color: #16213e;
            --primary-color: #e94560;
            --text-color: #e0e0e0;
            --text-muted: #a7a7a7;
            --border-color: #0f3460;
            --border-radius: 16px;
            --font-main: 'Poppins', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-main); background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 2rem 1rem; }
        .container { background-color: var(--card-color); border: 1px solid var(--border-color); padding: 2rem 2.5rem; border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); width: 100%; max-width: 900px; text-align: center; transition: all 0.3s ease; margin-bottom: 2rem; }
        h1, h2, h3 { font-weight: 700; margin-bottom: 1rem; }
        h1 { color: var(--primary-color); font-size: 2.5rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.2rem; color: var(--text-muted); }
        p { color: var(--text-muted); line-height: 1.6; margin-bottom: 1.5rem; }
        .lore-section { text-align: left; margin: 2rem 0; padding: 1.5rem; background-color: rgba(15, 52, 96, 0.3); border-radius: var(--border-radius); border-left: 4px solid var(--primary-color); }
        .lore-section p { margin-bottom: 0.5rem; }
        .button-group { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; }
        button, .button { background: var(--primary-color); color: white; border: none; padding: 0.8rem 1.8rem; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        button:hover, .button:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4); }
        button:disabled { background-color: #555; cursor: not-allowed; transform: none; box-shadow: none; }
        button.secondary { background: var(--border-color); }
        .form-group { margin: 1.5rem 0; text-align: left; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; color: var(--text-muted); }
        select, .radio-group { width: 100%; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 0.8rem 1rem; border-radius: 8px; font-size: 1rem; font-family: var(--font-main); }
        .radio-group { display: flex; justify-content: space-around; }
        
        /* --- NOWE STYLE ANIMACJI --- */
        #carousel-container {
            height: 120px;
            width: 100%;
            margin: 2rem auto;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
        }
        #carousel-track {
            display: flex;
            position: relative;
            left: 50%;
        }
        .carousel-item {
            flex-shrink: 0;
            width: 100px;
            height: 100px;
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--border-color);
            border-radius: 10px;
            transition: transform 0.3s ease;
        }
        .carousel-item .icon { font-size: 2.5rem; }
        .carousel-item .name { font-size: 0.8rem; font-weight: 600; margin-top: 5px; }

        #carousel-pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background-color: var(--primary-color);
            z-index: 10;
            box-shadow: 0 0 10px var(--primary-color);
        }

        /* Klasa dodawana do uruchomienia animacji */
        .spinning {
            transition: left 5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        #results-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        #results-table th, #results-table td { padding: 0.8rem 1rem; text-align: left; }
        #results-table thead { background-color: var(--border-color); }
        #results-table tbody tr { border-bottom: 1px solid var(--border-color); }
        #results-table tbody tr:nth-child(even) { background-color: rgba(15, 52, 96, 0.3); }
        .hidden { display: none !important; }
        
         /* --- NOWE STYLE SEKCJI SZCZEGÃ“ÅÃ“W --- */
        .details-section {
            text-align: left;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
        .details-section h2 {
            text-align: center;
            color: var(--primary-color);
        }
        .details-box {
            background-color: rgba(15, 52, 96, 0.3);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 2rem;
        }
        .details-box h3 {
            color: var(--text-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .transport-table {
            width: 100%;
            font-size: 0.9rem;
        }
        .transport-table td {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .transport-table td:first-child {
            width: 140px;
            white-space: nowrap;
        }
        .map-gallery {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }
        .map-gallery img {
            width: 31%;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .map-gallery img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }
        
        /* --- STYLE MODALA (POWIÄ˜KSZONEGO ZDJÄ˜CIA) --- */
        #lightbox {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #lightbox.active {
            opacity: 1;
            visibility: visible;
        }
        #lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--border-radius);
        }
        #lightbox .close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 3rem;
            color: white;
            cursor: pointer;
        }
         .transport-icon {
            display: inline-block;
            width: 30px;
            text-align: center;
        }
		/* --- NOWE STYLE PODSUMOWANIA --- */
Â  Â  Â  Â  #summary-stats {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  background-color: rgba(15, 52, 96, 0.4);
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  margin: 1.5rem 0;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  #summary-stats strong {
Â  Â  Â  Â  Â  Â  color: var(--primary-color);
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  margin-left: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  #results-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        /* --- NOWE STYLE GALERII KUCHNI --- */
		.cuisine-gallery {
		    display: flex;           /* Ustawia elementy w rzÄ™dzie */
		    flex-wrap: wrap;         /* Pozwala elementom zawijaÄ‡ siÄ™ do nowego wiersza */
		    justify-content: center; /* WyÅ›rodkowuje kafelki w poziomie */
		    gap: 8px;                /* Tworzy maÅ‚y odstÄ™p miÄ™dzy kafelkami */
		    margin-top: 1.5rem;      /* OdstÄ™p od nagÅ‚Ã³wka "Pula DostÄ™pnych Kuchni" */
		}

		/* --- MOBILE ULEPSZENIA DLA SEKCIJI SZCZEGÃ“ÅÃ“W --- */
/* ===== MOBILE (<=768px) â€“ peÅ‚ny pakiet stylÃ³w ===== */
@media (max-width: 768px) {

  /* Layout i typografia */
  body { padding: 1.25rem 0.75rem; }
  .container { padding: 1.25rem 1rem; }
  h1 { font-size: 1.9rem; line-height: 1.2; }
  h2 { font-size: 1.4rem; line-height: 1.25; }
  h3 { font-size: 1.05rem; line-height: 1.3; }

  /* Formularze i przyciski */
  .form-group { margin: 1.1rem 0; }
  label { font-size: 0.85rem; }
  select, .radio-group { font-size: 0.95rem; padding: 0.7rem 0.9rem; }
  .radio-group { gap: .75rem; justify-content: space-between; }
  .radio-group label { display: flex; align-items: center; gap: .4rem; }
  .button-group { flex-direction: column; gap: .75rem; }
  button, .button { width: 100%; padding: 0.85rem 1rem; }

  /* Karuzela losowania */
  #carousel-container { height: 100px; margin: 1.25rem 0; }
  .carousel-item { width: 88px; height: 88px; margin: 0 6px; }
  .carousel-item .icon { font-size: 2rem; }
  .carousel-item .name { font-size: 0.7rem; }

  /* Licznik czasu */
  #countdown-timer { gap: .6rem; margin: 1rem 0; font-size: 0.85rem; }
  #countdown-timer div { width: 72px; padding: 0.6rem; }
  #countdown-timer span { font-size: 2rem; }

  /* Dymek z poradami */
  #tip-bubble { max-width: 100%; margin-top: 1rem; padding: .85rem 1rem; }
  #tip-bubble p { font-size: .9rem; }

  /* Podsumowanie (statystyki) */
  #summary-stats { 
    flex-wrap: wrap; 
    gap: .5rem; 
    justify-content: space-between; 
    padding: .75rem; 
  }
  #summary-stats span { flex: 1 1 calc(50% - .5rem); text-align: center; }

  /* ===== Tabela wynikÃ³w â†’ kafelki ===== */
  #results-table thead { display: none !important; }
  #results-table { border-collapse: separate; width: 100%; }
  #results-table tbody { display: block; }
  #results-table tbody tr {
    display: block;
    margin: 0 0 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: rgba(15, 52, 96, 0.25);
  }
  #results-table tbody tr:nth-child(even) { background: rgba(15, 52, 96, 0.25); }
  #results-table td {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: .75rem;
    padding: .65rem .85rem;
    border: 0;
    text-align: right;
    white-space: normal;
    word-break: break-word;
  }
  #results-table td::before {
    content: attr(data-label);
    font-weight: 600;
    color: var(--text-muted);
    text-align: left;
    margin-right: .75rem;
  }

  /* ===== Sekcja â€SzczegÃ³Å‚y Imprezyâ€ ===== */
  .details-section { padding: 0 .5rem; }
  .details-section h2 { font-size: 1.6rem; margin-bottom: .25rem; }
  .details-box {
    padding: 1rem;
    border: 1px solid var(--border-color);
    background: rgba(15, 52, 96, 0.45);
  }
  .details-box h3 { font-size: 1.05rem; line-height: 1.3; gap: .4rem; }
  .details-box p { font-size: .95rem; }

  /* Transport: tabela â†’ karty */
  .transport-table { display: block; width: 100%; border-collapse: separate; border-spacing: 0; }
  .transport-table tbody {
    display: grid;
    grid-template-columns: 1fr;
    gap: .75rem;
  }
  .transport-table tr {
    display: grid;
    grid-template-columns: 1fr;
    background: rgba(15, 52, 96, 0.35);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: .75rem .9rem;
  }
  .transport-table td { display: block; border: 0; padding: .25rem 0; }
  .transport-table td:first-child {
    width: auto;
    white-space: normal;
    font-weight: 700;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: .5rem;
    padding-bottom: .25rem;
  }
  .transport-table td:last-child { color: var(--text-muted); padding-top: 0; }
  .transport-icon { width: 28px; text-align: center; flex: 0 0 28px; }

  /* Galerie map â€“ jedna kolumna */
  .map-gallery { flex-direction: column; gap: .75rem; align-items: stretch; }
  .map-gallery img { width: 100%; max-width: 100%; border-radius: 12px; }

  /* Lightbox â€“ Å‚atwiejsze trafienie kciukiem */
  #lightbox .close { top: 1rem; right: 1rem; font-size: 2.5rem; padding: .25rem .5rem; }

  /* Galeria kuchni â€“ ciaÅ›niejsze kafelki */
  .cuisine-gallery { gap: 6px; }
  .cuisine-gallery .carousel-item { width: 80px; height: 80px; }
  .cuisine-gallery .carousel-item .icon { font-size: 1.8rem; }
  .cuisine-gallery .carousel-item .name { font-size: .68rem; }

  /* Dodatkowe oddechy pod sekcjÄ… wynikÃ³w */
  #results-section { padding-bottom: .5rem; }
}


		
		/* Zmniejszamy rozmiar kafelkÃ³w wewnÄ…trz galerii */
		.cuisine-gallery .carousel-item {
		    width: 85px;  /* Nowa, mniejsza szerokoÅ›Ä‡ */
		    height: 85px; /* Nowa, mniejsza wysokoÅ›Ä‡ */
		    margin: 0;    /* Usuwamy stary margines na rzecz wÅ‚aÅ›ciwoÅ›ci 'gap' */
		}
		
		/* Zmniejszamy ikonÄ™, aby pasowaÅ‚a do mniejszego kafelka */
		.cuisine-gallery .carousel-item .icon {
		    font-size: 2rem;
		}
		
		/* Zmniejszamy tekst pod ikonÄ… */
		.cuisine-gallery .carousel-item .name {
		    font-size: 0.7rem;
		    font-weight: 500;
		}
		
		/* Style dla zajÄ™tych, przekreÅ›lonych kuchni */
		.cuisine-gallery .carousel-item.unavailable {
		    opacity: 0.4;
		    filter: grayscale(1);
		    text-decoration: line-through;
		    cursor: not-allowed;
		    transform: none; /* WyÅ‚Ä…cza efekt "podnoszenia siÄ™" przy najechaniu myszkÄ… */
		}
		
		/* Dodatkowa reguÅ‚a, aby na pewno nie byÅ‚o efektu hover na zajÄ™tych */
		.cuisine-gallery .carousel-item.unavailable:hover {
		    transform: none;
		    box-shadow: none;
		}
		/* --- NOWE STYLE DLA LICZNIKA --- */
		#countdown-timer {
		    display: flex;
		    justify-content: center;
		    gap: 1rem;
		    margin: 1.5rem 0;
		    font-weight: 300;
		    font-size: 0.9rem;
		    color: var(--text-muted);
		}
		#countdown-timer div {
		    background-color: rgba(15, 52, 96, 0.4);
		    padding: 0.8rem;
		    border-radius: 8px;
		    width: 80px;
		    text-align: center;
		}
		#countdown-timer span {
		    display: block;
		    font-size: 2.5rem;
		    font-weight: 700;
		    color: var(--primary-color);
		    line-height: 1.1;
		}
		/* --- NOWE STYLE DLA DYMKU Z PORADAMI --- */
		#tip-bubble {
    position: relative; /* Potrzebne do pozycjonowania "ogonka" */
    margin: 2.5rem auto 0; /* ZwiÄ™kszony margines gÃ³rny dla "ogonka" */
    max-width: 80%;
    /* Nowy, atrakcyjny gradient */
    background: linear-gradient(145deg, var(--border-color), var(--card-color));
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); /* WyraÅºniejszy cieÅ„ */
    padding: 1.2rem 1.8rem;
    border-radius: var(--border-radius); /* ZaokrÄ…glenie rogÃ³w */
    text-align: center;
    transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    opacity: 0; /* DomyÅ›lnie ukryty */
    transform: translateY(20px);
}

/* "Ogonek" dymka skierowany w gÃ³rÄ™ */
#tip-bubble::before {
    content: '';
    position: absolute;
    top: -10px; /* Umieszcza "ogonek" nad dymkiem */
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 10px solid var(--border-color); /* Kolor dopasowany do ramki */
}

#tip-bubble.visible {
    opacity: 1;
    transform: translateY(0);
}

#tip-bubble p {
    color: var(--text-color); /* Lepszy kontrast tekstu */
    font-style: normal; /* UsuniÄ™cie kursywy dla czytelnoÅ›ci */
    font-weight: 400;
    margin-bottom: 0;
    font-size: 0.95rem;
    line-height: 1.5;
}
    </style>
</head>
<body>
<div id="lightbox" class="hidden">
        <span class="close">&times;</span>
        <img id="lightbox-img" src="">
    </div>

    <div class="container">
        <div id="content-wrapper">
             <div id="step-invite">
                <h1>DomÃ³wka: Kuchnie Åšwiata! ğŸ—ºï¸</h1>
                <h3>Zaproszenie na epickÄ… podrÃ³Å¼ kulinarnÄ…</h3>
				 <div id="countdown-timer">
				    <div><span id="days">00</span>Dni</div>
				    <div><span id="hours">00</span>Godzin</div>
				    <div><span id="minutes">00</span>Minut</div>
				    <div><span id="seconds">00</span>Sekund</div>
				</div>
				 <div id="tip-bubble">
				    <p id="tip-text">Åadowanie protokoÅ‚u... dobrej zabawy...</p>
				</div>
                <p>Zanim przejdziemy dalej, odpowiedz na jedno, arcywaÅ¼ne pytanie...</p>
                <h2>Czy <u>4 paÅºdziernika</u> masz ochotÄ™ uczestniczyÄ‡ w tej imprezie?</h2>
                <div class="lore-section">
                    <p>ğŸŒ¶ï¸ <strong>Idea jest prosta:</strong> KaÅ¼dy uczestnik (lub para) losuje kuchniÄ™ i przygotowuje jedno, charakterystyczne dla niej danie.</p>
                    <p>ğŸ² <strong>Na miejscu czekajÄ…:</strong> Zacne trunki, gry bez prÄ…du, integracja i ploteczki do oporu.</p>
                     <p>ğŸ¤ <strong>Cel:</strong> SprÃ³bowaÄ‡ pysznego jedzenia i Å›wietnie siÄ™ bawiÄ‡ w doborowym towarzystwie!</p>
                </div>

                <div class="details-box" style="margin-top: 2rem; text-align: left;">
                    <h3 style="text-align: center;">ğŸ² Pula DostÄ™pnych Kuchni</h3>
                    <div class="cuisine-gallery" id="cuisine-gallery-invite">
                        </div>
                </div>
                                <div class="button-group">
                    <button id="btn-attend-yes">ğŸ‰ Tak, bÄ™dÄ™!</button>
                    <button id="btn-attend-no" class="secondary">ğŸ˜¢ Niestety, nie tym razem</button>
                </div>
            </div>

            <div id="step-details" class="hidden">
                <h2>Super, Å¼e bÄ™dziesz!</h2>
                <p>UzupeÅ‚nij jeszcze dwie rzeczy, abyÅ›my mogli wszystko przygotowaÄ‡.</p>
                <div class="form-group">
                    <label>Jestem...</label>
                    <select id="person-select"></select>
                </div>
                <div class="form-group">
                    <label>Czy bÄ™dziesz z osobÄ… towarzyszÄ…cÄ…?</label>
                    <div class="radio-group" id="guest-choice">
                        <label><input type="radio" name="guest" value="yes" checked> Tak</label>
                        <label><input type="radio" name="guest" value="no"> Nie</label>
                    </div>
                </div>
                <button id="btn-to-drawing">PrzejdÅº do losowania</button>
            </div>

            <div id="step-drawing" class="hidden">
                <h2>Czas na losowanie!</h2>
                <p>Kliknij przycisk i poznaj swoje kulinarne przeznaczenie.</p>
                <div id="carousel-container">
                    <div id="carousel-pointer"></div>
                    <div id="carousel-track"></div>
                </div>
                <button id="spin-button">Rozpocznij losowanie!</button>
            </div>
			<div id="step-refuse" class="hidden">
				<h2>Czy na pewno? ğŸ¤”</h2>
				<p>Wybierz swoje imiÄ™ z listy, aby potwierdziÄ‡, Å¼e jednak CiÄ™ nie bÄ™dzie.</p>
				<div class="form-group">
					<label>Jestem...</label>
					<select id="refuse-person-select"></select>
				</div>
				<div class="button-group">
					<button id="btn-confirm-refusal" class="secondary">Potwierdzam rezygnacjÄ™</button>
					<button id="btn-cancel-refusal">Jednak bÄ™dÄ™!</button>
				</div>
			</div>

        </div>
        
        <div id="results-section">
Â  Â  Â  Â  Â  Â  <h2 id="result-announcement"></h2>
            
            <div id="summary-stats">
                <span>âœ… Potwierdzeni: <strong id="stats-attending">0</strong></span>
                <span>âŒ Odmowy: <strong id="stats-declined">0</strong></span>
                <span>â” Czekamy: <strong id="stats-pending">0</strong></span>
            </div>
            Â  Â  Â  Â  Â  Â  <h3>Aktualna lista goÅ›ci i kuchni</h3>
            <table id="results-table">
                <thead>
                    <tr>
                        <th>ImiÄ™</th>
                        <th>ObecnoÅ›Ä‡</th>
                        <th>+1</th>
                        <th>Wylosowana Kuchnia</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    <tr><td colspan="4">Åadowanie danych...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="container details-section">
        <h2>SzczegÃ³Å‚y Imprezy</h2>
        
        <div class="details-box">
            <h3>ğŸ—“ï¸ Czas, Miejsce i Zasady</h3>
            <p><strong>Kiedy:</strong> Sobota, 4 paÅºdziernika 2025, start o <strong>18:00</strong>.<br>
               <strong>Gdzie:</strong> ul. Awicenny 32a/12, WrocÅ‚aw.</p>
            <p style="margin-bottom: 0;">KaÅ¼da osoba/para przygotowuje <strong>tylko jedno danie</strong> z wylosowanej kuchni. Prosimy nie przynosiÄ‡ za duÅ¼o jedzenia, aby nic siÄ™ nie zmarnowaÅ‚o!</p>
        </div>

        <div class="details-box">
            <h3>ğŸ¥‚ Alkohole i NastrÃ³j</h3>
            <p>ğŸ· Zapewniamy podstawowe iloÅ›ci <strong>wina biaÅ‚ego wytrawnego</strong>.<br>
               ğŸ¥ƒ DostÄ™pna bÄ™dzie rÃ³wnieÅ¼ butelka <strong>whisky</strong>.<br>
               ğŸ§Š Dla fanÃ³w mocniejszych trunkÃ³w czekaÄ‡ bÄ™dzie zmroÅ¼ona <strong>wÃ³dka</strong>.<br>
               ğŸ¥¤ OczywiÅ›cie postawiÄ™ teÅ¼ kilka <strong>napojÃ³w bezalkoholowych</strong> i przekÄ…sek.<br>
               ğŸ‘• ObowiÄ…zuje strÃ³j <strong>luÅºny i wygodny</strong>.<br>
               ğŸ˜Š NastrÃ³j: <strong>poprawny</strong> (przynajmniej na starcie)!
            </p>
        </div>

         <div class="details-box">
            <h3>â— WaÅ¼ne Info / Alergeny</h3>
            <p style="margin-bottom: 0;">ğŸˆâ€â¬› OstrzeÅ¼enie dla alergikÃ³w i pedantÃ³w! W domu rezydujÄ… dwa koty (<strong>czarny âš«</strong> i <strong>biaÅ‚o-bury âšª</strong>). Ich sierÅ›Ä‡ jest integralnÄ… czÄ™Å›ciÄ… wystroju mieszkania i na pewno wyjdziecie niÄ… oblepieni. Zapewniamy rolkÄ™ do ubraÅ„! âœ¨</p>
        </div>

        <div class="details-box">
            <h3>ğŸš— Transport i Dojazd</h3>
            <table class="transport-table">
                <tbody>
                    <tr><td><span class="transport-icon">âœˆï¸</span> Lotnisko</td><td>ok. 20 min samochodem</td></tr>
                    <tr><td><span class="transport-icon">ğŸš†</span> Dworzec Zach.</td><td>ok. 5 min pieszo ğŸš¶</td></tr>
                    <tr><td><span class="transport-icon">ğŸ…¿ï¸</span> Parking Biedronka</td><td>2 min pieszo ğŸš¶</td></tr>
                    <tr><td><span class="transport-icon">ğŸšŒ</span> <strong>Chachaja</strong></td><td>Linia: 132 (pod samym domem)</td></tr>
                    <tr><td><span class="transport-icon">ğŸšŒ</span> <strong>Jordanowska</strong></td><td>Linie: 132, 125, 907, 947 (4 min pieszo ğŸš¶)</td></tr>
                    <tr><td><span class="transport-icon">ğŸšŒ</span> <strong>Wiejska</strong></td><td>Linie: 107, 119, 125, 132, 143, 251, 257, 319, 607, 907, 947 (7 min pieszo ğŸš¶)</td></tr>
                    <tr><td><span class="transport-icon">ğŸšŠ</span> <strong>PÄ™tla OporÃ³w</strong></td><td>Tramwaje: 4, 11, 20. Autobusy: 107, 119, 125, 143, 251, 319 (8 min pieszo ğŸš¶)</td></tr>
                    <tr><td><span class="transport-icon">ğŸš¢</span> Statek</td><td>Ruch morski niedostÄ™pny</td></tr>
                    <tr><td><span class="transport-icon">ğŸ›¸</span> Dron</td><td>Ruch dronowy dostÄ™pny tylko ze wschodu</td></tr>
                </tbody>
            </table>
        </div>

         <div class="details-box">
            <h3>ğŸ—ºï¸ Mapy Dojazdu (kliknij, aby powiÄ™kszyÄ‡)</h3>
<div class="map-gallery">
  <img src="1.png" alt="Mapa okolicy" loading="lazy" decoding="async">
  <img src="2.png" alt="Mapa transportu" loading="lazy" decoding="async">
  <img src="3.png" alt="Mapa parkingu" loading="lazy" decoding="async">
</div>
        </div>
    </div>
    

<script>
// 1. KONFIGURACJA
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzwGqjTi-HuolG4nSiv2ekMlkm7c2-bd9TqYvJoiRZ7xPaZITdulpg7imLZUSRuelDauA/exec';
const MAX_RETRIES = 5;

// 2. REFERENCJE DO ELEMENTÃ“W DOM
const naggingQuestions = [
    "Ale na pewno? BÄ™dzie pyszne jedzonko...",
    "A co z doborowym towarzystwem? Tego teÅ¼ nie chcesz?",
    "PowaÅ¼nie? Nawet koty bÄ™dÄ… tÄ™skniÄ‡...",
    "Ostatnia szansa... MoÅ¼e jednak siÄ™ skusisz?",
    "To ostateczna decyzja? Bez Ciebie to nie bÄ™dzie to samo!"
];

const steps = {
    invite: document.getElementById('step-invite'),
    details: document.getElementById('step-details'),
    drawing: document.getElementById('step-drawing'),
    refuse: document.getElementById('step-refuse'), // Ta linia jest nowa
};
const contentWrapper = document.getElementById('content-wrapper');
const resultsSection = document.getElementById('results-section');
const personSelect = document.getElementById('person-select');
const historyBody = document.getElementById('history-body');
const spinButton = document.getElementById('spin-button');
const resultAnnouncement = document.getElementById('result-announcement');
const carouselTrack = document.getElementById('carousel-track');

// 3. STAN APLIKACJI
let appData = {
    participants: [],
    availableCuisines: []
};
let currentUser = { name: null };
let isSpinning = false;

// 4. FUNKCJE NAWIGACYJNE I WIDOKU
const goToStep = (stepName) => {
    Object.values(steps).forEach(step => step.classList.add('hidden'));
    if (steps[stepName]) {
        steps[stepName].classList.remove('hidden');
    }
};
	// POCZÄ„TEK NOWEJ FUNKCJI
const updateSummaryStats = () => {
    if (!appData.participants) return;

    let attendingCount = 0;
    let declinedCount = 0;
    let pendingCount = 0;

    appData.participants.forEach(p => {
        if (p.attending === true) {
            attendingCount++; // Osoba z listy
            if (p.guest) {
                attendingCount++; // Jej osoba towarzyszÄ…ca
            }
        } else if (p.attending === false) {
            declinedCount++;
        } else { // p.attending jest null
            pendingCount++;
        }
    });

    document.getElementById('stats-attending').textContent = attendingCount;
    document.getElementById('stats-declined').textContent = declinedCount;
    document.getElementById('stats-pending').textContent = pendingCount;
};
const renderInviteCuisineGallery = () => {
    const gallery = document.getElementById('cuisine-gallery-invite');
    if (!gallery || !appData.participants || !appData.availableCuisines) return;

    gallery.innerHTML = '';

    const drawnCuisines = appData.participants
        .filter(p => p.cuisine)
        .map(p => {
            const parts = p.cuisine.split(' ');
            const icon = parts.pop();
            const name = parts.join(' ');
            return { name, icon };
        });

    const allCuisines = [...appData.availableCuisines, ...drawnCuisines];
    allCuisines.sort((a, b) => a.name.localeCompare(b.name));
    const availableNames = new Set(appData.availableCuisines.map(c => c.name));

    allCuisines.forEach(cuisine => {
        const item = document.createElement('div');
        item.className = 'carousel-item';
        if (!availableNames.has(cuisine.name)) {
            item.classList.add('unavailable');
        }
        item.innerHTML = `<span class="icon">${cuisine.icon}</span><span class="name">${cuisine.name}</span>`;
        gallery.appendChild(item);
    });
};

const renderHistoryTable = () => {
	updateSummaryStats();
	renderInviteCuisineGallery();
    historyBody.innerHTML = '';
    if (!appData.participants || appData.participants.length === 0) {
        historyBody.innerHTML = '<tr><td colspan="4">Brak danych o uczestnikach.</td></tr>';
        return;
    }
    appData.participants.forEach(p => {
        const row = document.createElement('tr');
        const attendingText = p.attending === null ? 'â”' : (p.attending ? 'âœ… Tak' : 'âŒ Nie');
        const guestText = p.attending ? (p.guest ? 'ğŸ‘¤ Tak' : 'â– Nie') : 'â–';
        const cuisineText = p.attending ? (p.cuisine || '<em>Czeka na losowanie</em>') : 'â–';
        row.innerHTML = `<td data-label="ImiÄ™">${p.base}</td><td data-label="ObecnoÅ›Ä‡">${attendingText}</td><td data-label="+1">${guestText}</td><td data-label="Kuchnia">${cuisineText}</td>`;
        historyBody.appendChild(row);
    });
};

const initializeCarousel = (cuisines) => {
    carouselTrack.innerHTML = '';
    const extendedCuisines = [...cuisines, ...cuisines, ...cuisines, ...cuisines, ...cuisines];
    
    extendedCuisines.forEach(cuisine => {
        const item = document.createElement('div');
        item.className = 'carousel-item';
        item.innerHTML = `<span class="icon">${cuisine.icon}</span><span class="name">${cuisine.name}</span>`;
        carouselTrack.appendChild(item);
    });
};
	

// 5. LOGIKA DANYCH I API
const delay = ms => new Promise(res => setTimeout(res, ms));

const fetchWithRetry = async (url, options, retries = MAX_RETRIES) => {
    for (let i = 0; i <= retries; i++) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                 throw new Error(`BÅ‚Ä…d HTTP: ${response.status}`);
            }
            return response;
        } catch (error) {
            console.error(`PrÃ³ba ${i + 1} nieudana:`, error.message);
            if (i === retries) {
                console.error("OsiÄ…gniÄ™to maksymalnÄ… liczbÄ™ prÃ³b. PoddajÄ™ siÄ™.");
                throw error;
            }
            await delay(1000 * (i + 1)); // Czekaj 1, 2, 3... sekundy
        }
    }
};

	
	const cuisineTips = {
    "default": [
        "Ciekawe, kto pierwszy zapyta o hasÅ‚o do Wi-Fi...",
        "Plotka gÅ‚osi, Å¼e gospodarze ukryli najlepsze trunki. Czas na poszukiwania!",
        "PamiÄ™taj: kalorie zjedzone w dobrym towarzystwie nie tuczÄ…. To fakt naukowy.",
        "Trwa zakulisowa walka o to, kto przyniesie najlepsze danie. Stawki sÄ… wysokie.",
        "Koty juÅ¼ oceniajÄ…, czyje kolana bÄ™dÄ… dziÅ› najlepszym tronem. Przygotuj siÄ™."
    ],
    // --- Kuchnie juÅ¼ przypisane ---
    "Niemiecka": [
        "${name}, liczymy na porzÄ…dny, niemiecki Ordnung na talerzu! WÃ¼rst musi byÄ‡ idealnie prosty.",
        "Czy to prawda, ${name}, Å¼e TwÃ³j Schnitzel bÄ™dzie wiÄ™kszy niÅ¼ mapa Berlina? Zobaczymy!",
        "SÅ‚yszaÅ‚em, Å¼e ${name} robi saÅ‚atkÄ™ ziemniaczanÄ…. Oby byÅ‚a tak solidna jak niemiecka motoryzacja."
    ],
    "Angielska": [
        "Good heavens, ${name}! Czy to bÄ™dzie fish and chips, czy moÅ¼e shepherd's pie?",
        "Mam nadziejÄ™, Å¼e danie od ${name} bÄ™dzie lepsze niÅ¼ angielska pogoda!",
        "JeÅ›li ${name} robi Yorkshire pudding, to rezerwujÄ™ sobie od razu trzy sztuki."
    ],
    "Indyjska": [
        "${name}, czy Twoje curry bÄ™dzie tak aromatyczne, Å¼e sÄ…siedzi zapukajÄ… z wÅ‚asnymi talerzami?",
        "Podobno ${name} robi butter chicken, ktÃ³ry jest bardziej kremowy niÅ¼ obietnice politykÃ³w. Czekam!",
        "JeÅ›li ${name} przyniesie coÅ› z duÅ¼Ä… iloÅ›ciÄ… chili, przygotujcie gaÅ›nice... i szklanki z mlekiem."
    ],
    "GruziÅ„.": [
        "Gaumarjos, ${name}! Czy Twoje chaczapuri bÄ™dzie miaÅ‚o wystarczajÄ…co duÅ¼o sera, by uszczÄ™Å›liwiÄ‡ caÅ‚y narÃ³d?",
        "SÅ‚yszaÅ‚em, Å¼e ${name} szykuje chinkali. Uczymy siÄ™ je jeÅ›Ä‡ bez utraty cennego rosoÅ‚ku!",
        "JeÅ›li ${name} przyniesie wino z Gruzji, impreza oficjalnie osiÄ…gnie status legendy."
    ],
    "Hiszp.": [
        "${name}, czy Twoja paella bÄ™dzie miaÅ‚a wiÄ™cej owocÃ³w morza niÅ¼ jest uczestnikÃ³w imprezy?",
        "Tapas od ${name}? Brzmi jak idealny plan, Å¼eby sprÃ³bowaÄ‡ wszystkiego i nie wybraÄ‡ niczego konkretnego. Jak w Å¼yciu.",
        "Czy sangria od ${name} bÄ™dzie na tyle mocna, Å¼ebyÅ›my wszyscy zaczÄ™li mÃ³wiÄ‡ po hiszpaÅ„sku? Â¡OjalÃ¡!"
    ],
    "Francuska": [
        "Bonjour, ${name}! Czy Twoje danie bÄ™dzie tak wykwintne, jak francuskie perfumy?",
        "JeÅ›li ${name} robi zupÄ™ cebulowÄ…, to mam nadziejÄ™, Å¼e bÄ™dzie miaÅ‚a grzankÄ™ z serem grubÄ… na palec.",
        "Bagietki, sery, wino... ${name}, czy Ty na pewno robisz jedno danie, a nie caÅ‚Ä… francuskÄ… ucztÄ™?"
    ],
    // --- Nowe teksty dla pozostaÅ‚ych kuchni ---
    "Czeska": [
        "Ahoj, ${name}! Czy do Twoich knedlikÃ³w bÄ™dzie gulasz tak gÄ™sty, Å¼e aÅ¼ Å‚yÅ¼ka stanie?",
        "SmaÅ¾enÃ½ sÃ½r od ${name} podobno ciÄ…gnie siÄ™ bardziej niÅ¼ fabuÅ‚a w czeskich filmach. Sprawdzimy!",
        "Czy to prawda ${name}, Å¼e Twoje danie najlepiej popiÄ‡ zimnym... napojem chmielowym? ğŸ˜‰"
    ],
    "Grecka": [
        "Opa, ${name}! Czy Twoja moussaka bÄ™dzie miaÅ‚a tyle warstw, co staroÅ¼ytna grecka historia?",
        "Souvlaki od ${name}? Mam nadziejÄ™, Å¼e bÄ™dÄ… tak dobre, Å¼e aÅ¼ bogowie na Olimpie poczujÄ… zazdroÅ›Ä‡.",
        "Podobno ${name} robi saÅ‚atkÄ™ z fetÄ… tak autentycznÄ…, Å¼e moÅ¼na poczuÄ‡ bryzÄ™ z Santorini."
    ],
    "JapoÅ„ska": [
        "${name}, czy Twoje sushi bÄ™dzie zwiniÄ™te rÃ³wnie perfekcyjnie, co plany na tÄ™ noc?",
        "UwaÅ¼ajcie! Podobno wasabi od ${name} potrafi odblokowaÄ‡ wspomnienia z poprzednich wcieleÅ„.",
        "SÅ‚yszaÅ‚em, Å¼e ${name} przyniesie ramen. Oby byÅ‚ tak gÅ‚Ä™boki w smaku, jak nasze rozmowy o 3 nad ranem."
    ],
    "KoreaÅ„.": [
        "Annyeong, ${name}! Czy Twoje kimchi bÄ™dzie tak ostre, Å¼e aÅ¼ K-Pop sam zacznie graÄ‡ w gÅ‚oÅ›nikach?",
        "Bibimbap od ${name}? Mieszajcie dobrze, podobno im wiÄ™kszy baÅ‚agan w misce, tym lepszy smak!",
        "SÅ‚yszaÅ‚em, Å¼e ${name} robi bulgogi. To danie jest tak dobre, Å¼e staje siÄ™ narodowym skarbem... tej imprezy."
    ],
    "Meksyk.": [
        "Hola ${name}! Czy Twoje tacos bÄ™dÄ… tak ostre, jak atmosfera po trzeciej kolejce?",
        "SÅ‚yszaÅ‚em, Å¼e ${name} robi guacamole, ktÃ³re leczy zÅ‚amane serca. Oby nie byÅ‚o dziÅ› potrzebne!",
        "${name}, mam nadziejÄ™, Å¼e Twoja quesadilla bÄ™dzie bardziej sycÄ…ca niÅ¼ plotki, ktÃ³re dziÅ› usÅ‚yszymy."
    ],
    "Portugalska": [
        "OlÃ¡, ${name}! Czy Twoje danie z owocami morza bÄ™dzie tak Å›wieÅ¼e, jak poranek w Lizbonie?",
        "Pastel de nata od ${name}? JeÅ›li tak, to oficjalnie ogÅ‚aszam konkurs, kto zje najwiÄ™cej.",
        "JeÅ›li ${name} przyniesie bacalhau, to szykujcie siÄ™ na smak Portugalii w najlepszym wydaniu."
    ],
    "Tajska": [
        "${name}, czy Twoje pad thai bÄ™dzie idealnie balansowaÄ‡ miÄ™dzy sÅ‚odkim, kwaÅ›nym a ostrym? CaÅ‚a nadzieja w Tobie!",
        "Zielone curry od ${name}? Mam nadziejÄ™, Å¼e jest na mleczku kokosowym, a nie na Å‚zach naszych wrogÃ³w.",
        "SÅ‚yszaÅ‚em, Å¼e ${name} opanowaÅ‚/a sztukÄ™ tajskiej kuchni. Oby nie byÅ‚a to sztuka walki z ostroÅ›ciÄ…!"
    ],
    "Turecka": [
        "Merhaba, ${name}! Czy TwÃ³j kebab bÄ™dzie tak dobry, Å¼e zapomnimy o wszystkich innych daniach?",
        "JeÅ›li ${name} robi baklavÄ™, to lepiej schowajcie wagÄ™ na najbliÅ¼szy tydzieÅ„. BÄ™dzie sÅ‚odko!",
        "PonoÄ‡ hummus od ${name} jest tak kremowy, Å¼e moÅ¼na go uÅ¼ywaÄ‡ jako maseczki. Ale lepiej zjeÅ›Ä‡!"
    ],
    "Wietnam.": [
        "Xin chÃ o, ${name}! Czy Twoja zupa Pho bÄ™dzie tak aromatyczna, Å¼e jej zapach dotrze aÅ¼ do Hanoi?",
        "Sajgonki od ${name}? Szykujcie siÄ™ na chrupanie, ktÃ³re bÄ™dzie sÅ‚ychaÄ‡ w caÅ‚ym wojewÃ³dztwie.",
        "Podobno ${name} robi BÃ¡nh mÃ¬. To kanapka tak legendarna, Å¼e ma wÅ‚asny fanklub. ZapisujÄ™ siÄ™!"
    ],
    "WÅ‚oska": [
        "Mamma mia, ${name}! Czy to bÄ™dzie pizza na cienkim, czy grubym... podkÅ‚adzie do dobrej imprezy?",
        "Podobno ${name} robi tiramisu tak dobre, Å¼e anioÅ‚y Å›piewajÄ…. Czekamy na ten niebiaÅ„ski chÃ³r!",
        "JeÅ›li Twoje spaghetti, ${name}, bÄ™dzie tak dobre, jak wyglÄ…da, to reszta daÅ„ moÅ¼e siÄ™ schowaÄ‡."
    ],
    "Polska": [
        "Hej, ${name}! Czy Twoje pierogi bÄ™dÄ… z wody czy odsmaÅ¼ane? To pytanie dzieli narÃ³d bardziej niÅ¼ polityka.",
        "Schabowy od ${name} podobno ma rozmiar maÅ‚ego kontynentu. Przygotujcie Å¼oÅ‚Ä…dki.",
        "SÅ‚yszaÅ‚em, Å¼e bigos od ${name} 'przegryzaÅ‚ siÄ™' od ostatniej imprezy. To bÄ™dzie moc!"
    ]
};
	

	// Zmodyfikuj tÄ™ funkcjÄ™
const startTipCarousel = () => {
    // Zatrzymaj stary interwaÅ‚ z domyÅ›lnymi tekstami
    if (window.genericInterval) {
        clearInterval(window.genericInterval);
    }
    
    const tipBubble = document.getElementById('tip-bubble');
    const tipText = document.getElementById('tip-text');
    if (!tipBubble || !tipText) return;

    // Reszta funkcji pozostaje BEZ ZMIAN...
    let messagePlaylist = [];
    const confirmedGuests = appData.participants.filter(p => p.attending === true && p.cuisine);

    if (confirmedGuests.length > 0) {
        confirmedGuests.forEach(guest => {
            const cuisineFullName = guest.cuisine;
            const cuisineBaseName = Object.keys(cuisineTips).find(key => cuisineFullName.startsWith(key));
            if (cuisineBaseName && cuisineTips[cuisineBaseName]) {
                const personalizedTips = cuisineTips[cuisineBaseName].map(tip => tip.replace('${name}', guest.base));
                messagePlaylist.push(...personalizedTips);
            }
        });
    }

    if (messagePlaylist.length === 0) {
        messagePlaylist.push(...cuisineTips.default);
    }

    messagePlaylist.sort(() => Math.random() - 0.5);
    let currentTipIndex = 0;
    const showNextTip = () => {
        tipBubble.classList.remove('visible');
        setTimeout(() => {
            tipText.textContent = messagePlaylist[currentTipIndex];
            currentTipIndex = (currentTipIndex + 1) % messagePlaylist.length;
            tipBubble.classList.add('visible');
        }, 600);
    };
    
    // Uruchom od razu nowy cykl (bez czekania)
    showNextTip(); 
    setInterval(showNextTip, 8000);
};

	// Nowa funkcja do natychmiastowego startu
const startGenericTipCarousel = () => {
    const tipBubble = document.getElementById('tip-bubble');
    const tipText = document.getElementById('tip-text');
    if (!tipBubble || !tipText) return;

    // UÅ¼ywamy tylko domyÅ›lnych tekstÃ³w
    let messagePlaylist = [...cuisineTips.default];
    messagePlaylist.sort(() => Math.random() - 0.5);
    
    let currentTipIndex = 0;

    const showNextTip = () => {
        tipBubble.classList.remove('visible');
        setTimeout(() => {
            tipText.textContent = messagePlaylist[currentTipIndex];
            currentTipIndex = (currentTipIndex + 1) % messagePlaylist.length;
            tipBubble.classList.add('visible');
        }, 600);
    };
    
    setTimeout(showNextTip, 1500); // Start po 1.5s
    
    // Zapisujemy interwaÅ‚ do zmiennej globalnej, aby go pÃ³Åºniej zatrzymaÄ‡
    window.genericInterval = setInterval(showNextTip, 8000); 
};

const loadData = async () => {
    try {
        const response = await fetchWithRetry(GOOGLE_SCRIPT_URL); 
        const data = await response.json();
        appData = data;
        renderHistoryTable();
        populatePersonSelect();
        populateRefuseSelect();
		startTipCarousel();
    } catch (error) {
        console.error("BÅ‚Ä…d Å‚adowania danych z Google Sheets:", error);
        historyBody.innerHTML = '<tr><td colspan="4">Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ danych. OdÅ›wieÅ¼ stronÄ™.</td></tr>';
    }
};

const saveData = async () => {
    try {
        await fetchWithRetry(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            redirect: "follow", 
            headers: {
                "Content-Type": "text/plain;charset=utf-8",
            },
            body: JSON.stringify(appData)
        });
        // Po zapisie odÅ›wieÅ¼amy dane, aby mieÄ‡ pewnoÅ›Ä‡, Å¼e wszystko jest aktualne
        await loadData();
    } catch (error) {
        console.error("BÅ‚Ä…d zapisu danych do Google Sheets:", error);
        resultAnnouncement.innerHTML = `<h2 style="color:red">BÅ‚Ä…d zapisu! SprÃ³buj ponownie.</h2>`;
    }
};


const populatePersonSelect = () => {
    personSelect.innerHTML = '';
    let availablePeople = 0;
    if (appData.participants) {
        appData.participants.forEach(p => {
            if (p.attending === null || (p.attending && !p.cuisine)) {
                const option = document.createElement('option');
                option.value = p.base;
                option.textContent = p.declined;
                personSelect.appendChild(option);
                availablePeople++;
            }
        });
    }
    if (availablePeople === 0) {
        document.getElementById('step-details').innerHTML = '<p>WyglÄ…da na to, Å¼e wszyscy juÅ¼ wziÄ™li udziaÅ‚. Zobacz wyniki poniÅ¼ej!</p>';
    }
};

const startCarousel = () => {
    if (isSpinning) return;
    const availableCuisines = appData.availableCuisines;
    if (!availableCuisines || availableCuisines.length === 0) {
        alert("Wszystkie kuchnie zostaÅ‚y juÅ¼ wylosowane!");
        return;
    }

    isSpinning = true;
    spinButton.disabled = true;

    const randomIndex = Math.floor(Math.random() * availableCuisines.length);
    const selectedCuisine = availableCuisines[randomIndex];

    const targetIndex = availableCuisines.length + randomIndex;
    const itemWidth = 120;
    const targetPosition = - (targetIndex * itemWidth) + (carouselTrack.parentElement.clientWidth / 2) - (itemWidth / 2);

    carouselTrack.classList.add('spinning');
    carouselTrack.style.left = `${targetPosition}px`;

    setTimeout(async () => {
        const cuisineString = selectedCuisine.name + " " + selectedCuisine.icon;
        resultAnnouncement.innerHTML = `<h2>Gratulacje, <span style="color:var(--primary-color)">${currentUser.name}!</span></h2>
                                      <p>Twoje przeznaczenie to: <strong>${cuisineString}</strong></p>`;
        
        const personIndex = appData.participants.findIndex(p => p.base === currentUser.name);
        if (personIndex > -1) {
            appData.participants[personIndex].cuisine = cuisineString;
            appData.availableCuisines.splice(randomIndex, 1);
        }
        
        await saveData();
        isSpinning = false;
        contentWrapper.classList.add('hidden');
    }, 5100);
};
// DODAJ caÅ‚Ä… tÄ™ nowÄ… funkcjÄ™
const populateRefuseSelect = () => {
    const refuseSelect = document.getElementById('refuse-person-select');
    refuseSelect.innerHTML = '';
    let availablePeople = 0;
    if (appData.participants) {
        appData.participants.forEach(p => {
            // PokaÅ¼ osoby niezdecydowane (null) lub te, ktÃ³re juÅ¼ potwierdziÅ‚y (true)
            if (p.attending === null || p.attending === true) {
                const option = document.createElement('option');
                option.value = p.base;
                option.textContent = p.declined;
                refuseSelect.appendChild(option);
                availablePeople++;
            }
        });
    }
    if (availablePeople === 0) {
        document.getElementById('step-refuse').innerHTML = '<p>WyglÄ…da na to, Å¼e wszyscy juÅ¼ podjÄ™li ostatecznÄ… decyzjÄ™!</p>';
    }
};

// DODAJ caÅ‚Ä… tÄ™ nowÄ… funkcjÄ™
const handleRefusal = async () => {
    const refuseSelect = document.getElementById('refuse-person-select');
    const name = refuseSelect.value;
    if (!name) return;

    // PÄ™tla z mÄ™czÄ…cymi pytaniami
    for (const question of naggingQuestions) {
        if (!confirm(question)) {
            alert("Uff, co za ulga! Dobrze, Å¼e zostajesz! ğŸ˜„");
            goToStep('invite');
            return; // Przerwij proces odmowy
        }
    }

    const personIndex = appData.participants.findIndex(p => p.base === name);
    if (personIndex > -1) {
        const person = appData.participants[personIndex];

        // SprawdÅº, czy osoba miaÅ‚a przypisanÄ… kuchniÄ™
        if (person.cuisine) {
            const cuisineString = person.cuisine;
            // Proste parsowanie: "Nazwa Kuchni  ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸"
            const parts = cuisineString.split(' ');
            const icon = parts.pop();
            const cuisineName = parts.join(' ');
            
            // StwÃ³rz obiekt kuchni i dodaj go z powrotem do puli
            const returnedCuisine = { name: cuisineName, icon: icon };
            appData.availableCuisines.push(returnedCuisine);
            
            // Opcjonalnie: sortuj listÄ™ kuchni dla porzÄ…dku
            appData.availableCuisines.sort((a, b) => a.name.localeCompare(b.name));
        }

        // Zaktualizuj dane osoby
        person.attending = false;
        person.guest = false; // Resetuj osobÄ™ towarzyszÄ…cÄ…
        person.cuisine = null; // UsuÅ„ kuchniÄ™

        await saveData();
        contentWrapper.classList.add('hidden');
        resultAnnouncement.innerHTML = `<h2>Szkoda, Å¼e CiÄ™ nie bÄ™dzie, ${name}.</h2><p>DziÄ™ki za informacjÄ™! Do zobaczenia nastÄ™pnym razem.</p>`;
    }
};

// 7. INICJALIZACJA I OBSÅUGA ZDARZEÅƒ
document.addEventListener('DOMContentLoaded', () => {
    
    document.getElementById('btn-attend-yes').addEventListener('click', () => {
	    goToStep('details');
	    // DODANA LINIA: PÅ‚ynne przewiniÄ™cie do nowego widoku
	    document.getElementById('step-details').scrollIntoView({ behavior: 'smooth', block: 'center' });
	});

    document.getElementById('btn-attend-no').addEventListener('click', () => {
		goToStep('refuse');
	});
	
	document.getElementById('btn-confirm-refusal').addEventListener('click', handleRefusal);
	document.getElementById('btn-cancel-refusal').addEventListener('click', () => goToStep('invite'));
    
    document.getElementById('btn-to-drawing').addEventListener('click', () => {
        currentUser.name = personSelect.value;
        const personData = appData.participants.find(p => p.base === currentUser.name);

        if (personData && personData.cuisine) {
            alert('JuÅ¼ braÅ‚eÅ›/aÅ› udziaÅ‚ w losowaniu! Zobacz swÃ³j wynik w tabeli.');
            contentWrapper.classList.add('hidden');
            resultAnnouncement.innerHTML = `<h2>TwÃ³j wynik jest juÅ¼ w tabeli, ${personData.base}!</h2>`;
            return;
        }

        const personIndex = appData.participants.findIndex(p => p.base === currentUser.name);
        if (personIndex > -1) {
            appData.participants[personIndex].attending = true;
            appData.participants[personIndex].guest = document.querySelector('input[name="guest"]:checked').value === 'yes';
        }
        
        initializeCarousel(appData.availableCuisines);
        goToStep('drawing');
		
    });

    spinButton.addEventListener('click', startCarousel);
    
    loadData();
    goToStep('invite');
	startGenericTipCarousel();
});
// --- DODATKOWA LOGIKA DLA GALERII MAP ---
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    const galleryImages = document.querySelectorAll('.map-gallery img');

    galleryImages.forEach(img => {
        img.addEventListener('click', () => {
            lightbox.classList.remove('hidden');
            lightbox.classList.add('active');
            lightboxImg.src = img.src;
        });
    });

    lightbox.addEventListener('click', (e) => {
        if (e.target !== e.currentTarget && e.target.tagName !== 'SPAN') return;
        lightbox.classList.remove('active');
        setTimeout(() => {
            lightbox.classList.add('hidden');
        }, 300);
    });
	const partyDate = new Date('2025-10-04T18:00:00').getTime();
const countdownInterval = setInterval(() => {
    const now = new Date().getTime();
    const distance = partyDate - now;

    if (distance < 0) {
        clearInterval(countdownInterval);
        document.getElementById('countdown-timer').innerHTML = "<h2>Impreza trwa w najlepsze!</h2>";
        return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById('days').innerText = String(days).padStart(2, '0');
    document.getElementById('hours').innerText = String(hours).padStart(2, '0');
    document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
    document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
}, 1000);

</script>

</body>
</html>





















